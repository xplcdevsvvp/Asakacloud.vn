{% extends "base.html" %}

{% block title %}Mua d·ªãch v·ª• {{ service.name }} - AsakaCloud{% endblock %}

{% block extra_css %}
<style>
    .payment-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }
    .payment-modal.active {
        display: flex;
    }
    .payment-content {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 3rem;
        max-width: 600px;
        width: 90%;
        border: 1px solid var(--border-color);
        text-align: center;
    }
    .qr-code-wrapper {
        background: white;
        padding: 2rem;
        border-radius: 16px;
        margin: 2rem 0;
        display: inline-block;
    }
    .qr-code-wrapper img {
        max-width: 300px;
        width: 100%;
    }
    .bank-info {
        background: var(--bg-secondary);
        padding: 1.5rem;
        border-radius: 12px;
        margin-top: 1.5rem;
        text-align: left;
    }
    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 0.8rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    .info-row:last-child {
        border-bottom: none;
    }
    .copy-btn {
        background: var(--primary-color);
        border: none;
        padding: 0.3rem 0.8rem;
        border-radius: 6px;
        color: white;
        cursor: pointer;
        font-size: 0.85rem;
    }
</style>
{% endblock %}

{% block content %}
<section class="buy-section">
    <div class="container">
        <div class="buy-grid">
            <div class="service-detail-card glass-card animate-on-scroll">
                <h2 class="card-title">Chi ti·∫øt g√≥i d·ªãch v·ª•</h2>
                
                {% if service.badge %}
                <div class="badge badge-{{ 'premium' if 'PERFORMANCE' in service.badge else 'featured' if 'BEST' in service.badge else 'dedicated' }}">
                    {{ service.badge }}
                </div>
                {% endif %}
                
                <h1 class="service-name-large">{{ service.name }}</h1>
                <p class="service-description">{{ service.description }}</p>
                
                <div class="specs-list">
                    <div class="spec-item-large">
                        <strong>CPU:</strong> {{ service.cpu }}
                    </div>
                    <div class="spec-item-large">
                        <strong>RAM:</strong> {{ service.ram }}
                    </div>
                    <div class="spec-item-large">
                        <strong>Storage:</strong> {{ service.storage }}
                    </div>
                    <div class="spec-item-large">
                        <strong>Bandwidth:</strong> {{ service.bandwidth }}
                    </div>
                    <div class="spec-item-large">
                        <strong>Datacenter:</strong> VNPT Datacenter
                    </div>
                    <div class="spec-item-large">
                        <strong>Protection:</strong> AntiDDoS Pro
                    </div>
                </div>
                
                <div class="price-display">
                    <span class="price-label">Gi√°:</span>
                    <span class="price-amount">{{ "{:,}".format(service.price) }} VND</span>
                </div>
            </div>
            
            <div class="payment-card glass-card animate-on-scroll">
                <h2 class="card-title">Thanh to√°n</h2>
                
                <div class="payment-methods">
                    <div class="payment-method active" data-method="bank_transfer">
                        <div class="method-icon">üè¶</div>
                        <div class="method-info">
                            <div class="method-name">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</div>
                            <div class="method-description">Qu√©t m√£ QR ho·∫∑c chuy·ªÉn kho·∫£n th·ªß c√¥ng</div>
                        </div>
                        <div class="method-radio">‚úì</div>
                    </div>
                </div>
                
                <div class="order-summary">
                    <div class="summary-row">
                        <span>G√≥i d·ªãch v·ª•:</span>
                        <span>{{ service.name }}</span>
                    </div>
                    <div class="summary-row">
                        <span>Th·ªùi h·∫°n:</span>
                        <span>1 th√°ng</span>
                    </div>
                    <div class="summary-row total">
                        <span>T·ªïng c·ªông:</span>
                        <span>{{ "{:,}".format(service.price) }} VND</span>
                    </div>
                </div>
                
                <button class="btn btn-primary-large full-width" onclick="createOrder({{ service.id }})">
                    Ti·∫øp t·ª•c thanh to√°n
                </button>
                
                <div class="payment-note">
                    <p>‚úÖ M√°y ch·ªß s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t ngay sau khi thanh to√°n</p>
                    <p>‚úÖ H·ªó tr·ª£ 24/7 qua Discord v√† Ticket</p>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="payment-modal" id="paymentModal">
    <div class="payment-content">
        <h2>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</h2>
        <p>Vui l√≤ng chuy·ªÉn kho·∫£n ƒë√∫ng n·ªôi dung ƒë·ªÉ ƒë∆°n h√†ng ƒë∆∞·ª£c x·ª≠ l√Ω t·ª± ƒë·ªông</p>
        
        <div class="qr-code-wrapper">
            <img id="qrCodeImage" src="" alt="QR Code">
        </div>
        
        <div class="bank-info" id="bankInfo">
            <div class="info-row">
                <span><strong>Ng√¢n h√†ng:</strong></span>
                <span id="bankName">-</span>
            </div>
            <div class="info-row">
                <span><strong>S·ªë t√†i kho·∫£n:</strong></span>
                <span>
                    <span id="accountNumber">-</span>
                    <button class="copy-btn" onclick="copyToClipboard('accountNumber')">Copy</button>
                </span>
            </div>
            <div class="info-row">
                <span><strong>Ch·ªß t√†i kho·∫£n:</strong></span>
                <span id="accountName">-</span>
            </div>
            <div class="info-row">
                <span><strong>S·ªë ti·ªÅn:</strong></span>
                <span>
                    <span id="amount">-</span>
                    <button class="copy-btn" onclick="copyToClipboard('amount')">Copy</button>
                </span>
            </div>
            <div class="info-row">
                <span><strong>N·ªôi dung:</strong></span>
                <span>
                    <span id="content">-</span>
                    <button class="copy-btn" onclick="copyToClipboard('content')">Copy</button>
                </span>
            </div>
        </div>
        
        <button class="btn btn-secondary" onclick="closePaymentModal()">ƒê√≥ng</button>
    </div>
</div>

<script>
function createOrder(serviceId) {
    fetch('/api/create-order', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            service_id: serviceId,
            payment_method: 'bank_transfer'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showPaymentModal(data.bank_info);
        } else {
            alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
    });
}

function showPaymentModal(bankInfo) {
    document.getElementById('qrCodeImage').src = bankInfo.qr_code;
    document.getElementById('bankName').textContent = bankInfo.bank_name;
    document.getElementById('accountNumber').textContent = bankInfo.account_number;
    document.getElementById('accountName').textContent = bankInfo.account_name;
    document.getElementById('amount').textContent = bankInfo.amount.toLocaleString() + ' VND';
    document.getElementById('content').textContent = bankInfo.content;
    
    document.getElementById('paymentModal').classList.add('active');
}

function closePaymentModal() {
    document.getElementById('paymentModal').classList.remove('active');
    window.location.href = '{{ url_for("profile") }}';
}

function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.textContent.trim();
    navigator.clipboard.writeText(text).then(() => {
        alert('ƒê√£ copy: ' + text);
    });
}
</script>
{% endblock %}
